RewriteEngine On

# Forza l'uso di index.php per gestire il login e i ruoli
# MA escludi i file reali che esistono (come i file .js del service worker)
# affinché il server li serva direttamente con il MIME type corretto.

# Se il file esiste, servilo direttamente (cruciale per ngsw-worker.js, manifest, icone)
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^ - [L]

# Se l'utente accede alla cartella /notes/ (senza specificare un file)
# servi index.php per il controllo permessi.
DirectoryIndex index.php index.html

# Se la richiesta non è un file o una directory reale, servi index.php
# Questo supporta il routing di Angular mantenendo la protezione PHP
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^ index.php [L]
